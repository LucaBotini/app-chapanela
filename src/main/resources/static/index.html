<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Ch치 de Panela - Escolha seu Presente</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: #0d1b3d;
        color: white;
      }
      .card {
        background: #152659;
        border: none;
        border-radius: 12px;
      }
      .table {
        background: white !important;
        border-radius: 10px;
        overflow: hidden;
      }
      h2,
      h4 {
        font-weight: 600;
      }
    </style>
  </head>
  <body class="container py-4">
    <div class="text-center mb-4">
      <h2>游꾸 Ch치 de Panela</h2>
      <h4>Escolha um item para presentear</h4>
    </div>

    <div class="card p-4 mb-4 text-white">
      <form id="formEscolha">
        <div class="mb-3">
          <label class="form-label">Seu nome:</label>
          <input
            type="text"
            class="form-control"
            id="nome"
            placeholder="Michele"
            required
          />
        </div>

        <div class="mb-3">
          <label class="form-label">Escolha um presente:</label>
          <select class="form-select" id="item" required></select>
        </div>

          <div id="msgSucesso" class="alert alert-success text-center d-none">
              Presente registrado com sucesso! 游꾸
          </div>
        <button type="submit" class="btn btn-light w-100">Enviar</button>
      </form>
    </div>

    <script>
      // Carregar lista de itens
      fetch("/escolha/itens")
        .then((res) => res.json())
        .then((data) => {
          const select = document.getElementById("item");
          select.innerHTML =
            "<option value='' disabled selected>Selecione um item</option>";
          data.forEach((item) => {
            select.innerHTML += `<option value="${item}">${item}</option>`;
          });
        });

      // Submeter escolha
      document.getElementById("formEscolha").addEventListener("submit", function(event) {
          event.preventDefault();

          const nome = document.getElementById("nome").value;
          const item = document.getElementById("item").value;

          fetch(`/escolha?nome=${nome}&item=${item}`, { method: "POST" })
              .then(response => {
                  if (response.ok) {

                      // Mostrar mensagem de sucesso
                      const msg = document.getElementById("msgSucesso");
                      msg.classList.remove("d-none");
                      msg.textContent = `Obrigado, ${nome}! Voc칡 escolheu: ${item} 游꾸`;

                      carregarTabela();
                      document.getElementById("formEscolha").reset();

                      // Sumir mensagem depois de 3 segundos
                      setTimeout(() => {
                          msg.classList.add("d-none");
                      }, 3000);

                  } else {
                      alert("Erro ao salvar! Tente novamente.");
                  }
              });
      });
    </script>
  </body>
</html>
